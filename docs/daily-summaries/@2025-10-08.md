# 2025-10-08 — Geckoforge v0.3.0 Implementation Rollup

## Highlights
- Completed browser transition from Chrome to a hardened Chromium configuration with Manifest V2 privacy/developer extensions and GPU-friendly flags.
- Expanded developer toolchain to cover TypeScript, Go, Python, Nim, .NET, R, and an asdf-managed Elixir stack (Erlang 28.1, Elixir 1.18.4, Phoenix 1.7.12).
- Replaced Podman workflows with Docker, including automated removal, weekly pruning, NVIDIA Container Toolkit integration, and updated first-run UX.
- Added TeX Live `combined.scheme-medium`, supporting docs, and verification procedures tailored for Leap 15.6 stability.
- Delivered new documentation, examples, and Home-Manager modules alongside cleanup of Podman-era assets.

## Detailed Changes

### Container Runtime & Scripts
- Deleted legacy Podman scripts (`setup-podman.sh`, `podman-*-*.sh`) and introduced Docker equivalents: `setup-docker.sh`, `docker-nvidia-install.sh`, `docker-nvidia-verify.sh`.
- Updated `firstrun-user.sh` workflow to a four-step process focusing on Docker setup, NVIDIA toolkit, Flatpak installs, and Home-Manager bootstrap.
- Converted prune timers/services to target Docker (`docker system prune`).
- Updated example scripts: CUDA quick test, systemd GPU service Makefile/README now use Docker syntax; added `scripts/examples/postgres-docker-compose/` sample stack.

### Desktop & Developer Tooling
- `home/modules/desktop.nix`: now bundles Chromium, installs curated privacy/developer extensions (uBlock, HTTPS Everywhere, Privacy Badger, React DevTools, Altair, Requestly, Refined GitHub, Dark Reader, SponsorBlock), and tightens command-line flags (VAAPI, GPU rasterization, dark mode, telemetry suppression).
- `home/modules/development.nix`: expanded package set for multi-language dev (Node.js 22 + TypeScript, Go 1.24, Python 3.12 w/ pip/virtualenv/poetry, Nim, .NET SDK 9, R + languageserver) plus cloud/infra tools (awscli2, gcloud, terraform, terraform-ls, kubectl, helm, k9s). Added TeX Live scheme-medium with stability notes, Docker shell aliases, direnv integration, and git ignore defaults.
- New `home/modules/elixir.nix`: provisions asdf, installs Erlang 28.1, Elixir 1.18.4-otp-28, Node.js 22.x, Hex/Rebar, Phoenix archive, and wires ElixirLS into VS Code. Activation hook handles key imports and reshim.
- `home/home.nix`: imports the Elixir module; other modules unchanged.

### KIWI ISO Layer
- `profiles/leap-15.6/kde-nvidia/config.kiwi.xml`: annotated that Docker is layered post-install (no runtime baked into ISO); Podman packages removed from image layer.

### Documentation
- `README.md`: now highlights Docker runtime, multi-language scope, TeX Live scheme-medium, and references new guides (`docker-nvidia.md`, `tex-verification.md`, migration doc).
- `docs/getting-started.md`: switched verification steps to Docker commands, removed Chrome prompt, referenced TeX verification guide, and updated troubleshooting (Docker group, GPU toolkit).
- `docs/recovery.md`: updated checklists to Docker GPU scripts.
- `docs/testing-plan.md`: reworked user-setup and GPU test cases for Docker, added TeX validation step, adjusted acceptance criteria.
- Added new guides: `docs/podman-to-docker-migration.md`, `docs/docker-nvidia.md`, `docs/tex-verification.md`.
- Removed obsolete `docs/podman-nvidia.md`.
- `docs/architecture/directory-tree.md`: refreshed tree to reflect new/removed files.

### Miscellaneous
- `.gitignore`: added Docker-specific artifacts (`docker-compose.override.yml`, `.env*`, `*.log`).
- Ensured new Docker scripts are executable; ran `bash -n` syntax checks (shellcheck unavailable on host).

## Follow-ups / Open Items
- Optional: install `shellcheck` on dev host for CI lint coverage.
- Consider automating `kiwi-build` smoke test post-change to validate ISO layer.
- Monitor Elixir asdf builds (15–20 min) for timeouts; document caching strategies if needed.


# Geckoforge Rules v0.3.0 - Implementation Summary

## What Was Created

Based on your requirements, I've created **5 new rule files** and **2 update sections** to address the gaps you identified:

---

## New Rule Files

### 1. **25-lefthook-quality.mdc** ✅
**Purpose**: Pre-commit and pre-push quality gates  
**Why needed**: Automate validation to catch errors early

**Key features:**
- Pre-commit checks (< 30s): shellcheck, Nix syntax, XML validation, anti-pattern detection
- Pre-push checks (< 5 min): package verification, layer validation, ISO build smoke test
- Executable bit checking
- TODO/FIXME tracking
- Example lefthook.yml configuration

**Integration points:**
- Install lefthook via zypper or Nix
- Create `lefthook.yml` at repo root
- Add validation scripts to `tools/validate/`

---

### 2. **70-troubleshooting.mdc** ✅
**Purpose**: Systematic debugging procedures by layer  
**Why needed**: Reduce time wasted on common issues

**Key features:**
- Quick diagnostic commands by layer
- ISO build troubleshooting
- First-boot service debugging
- Docker/NVIDIA issues
- Home-Manager failures
- Rollback procedures (Btrfs + Nix)
- Emergency boot recovery

**When to use:**
- System not booting
- Services failing
- GPU not detected
- Packages won't install

---

### 3. **55-networking-privacy.mdc** ✅
**Purpose**: VPN (ProtonVPN) and DNS privacy  
**Why needed**: You requested ProtonVPN + privacy DNS

**Key features:**
- Quad9 DNS configuration (privacy-respecting)
- ProtonVPN CLI installation
- Firewall rules (UFW)
- Docker DNS leak prevention
- KDE privacy settings
- Chromium privacy hardening
- Travel/public WiFi checklist

**Scripts to create:**
- `scripts/setup-dns.sh`
- `scripts/setup-protonvpn.sh`

---

### 4. **65-backup-restore.mdc** ✅
**Purpose**: 3-2-1 backup strategy  
**Why needed**: Data protection with rclone + external HDDs

**Key features:**
- External HDD backup (LUKS encrypted)
- Rclone offsite backup (encrypted)
- Git config backup (automatic)
- Future NAS integration placeholder
- Backup/restore scripts
- Automation via cron/systemd timers
- Disaster recovery plan

**Backup tiers:**
- Tier 1 (Daily): Git repos, IDE configs, SSH/GPG keys, documents
- Tier 2 (Weekly): Active projects, database dumps
- Tier 3 (Monthly): Archives, media, large datasets

**Scripts to create:**
- `scripts/setup-backup-hdd.sh`
- `scripts/backup-to-hdd.sh`
- `scripts/restore-from-hdd.sh`
- `scripts/setup-rclone.sh`
- `scripts/backup-to-cloud.sh`
- `scripts/restore-from-cloud.sh`

---

### 5. **75-ide-config.mdc** ✅
**Purpose**: IDE configuration management  
**Why needed**: You use VS Code, Cursor, Kiro (AWS), Void (Ollama)

**Key features:**
- VS Code configuration via Home-Manager
- Extension list backup/restore
- Cursor sync from VS Code
- Kiro (AWS) configuration
- Void (Ollama) integration
- JetBrains Mono font setup
- Unified backup/restore scripts

**Home-Manager module:**
- `home/modules/ide.nix` (VS Code + extensions + settings)
- Font installation (JetBrains Mono, Fira Code)

**Scripts to create:**
- `scripts/backup-vscode-extensions.sh`
- `scripts/restore-vscode-extensions.sh`
- `scripts/sync-cursor-from-vscode.sh`
- `scripts/backup-ide-configs.sh`
- `scripts/restore-ide-configs.sh`

---

## Updates to Existing Rules

### 6. **10-kiwi-architecture.mdc** (Addition) 🔄
**New section**: Laptop-Specific Patterns

**What's added:**
- TLP power management configuration
- Battery optimization (80% charge limit)
- Suspend/resume handling for NVIDIA
- Hybrid graphics (PRIME offload)
- Laptop hardware quirks (touchpad, brightness, Fn keys)
- Testing checklist for laptops
- Known limitations (desktop prioritized)

**Where to add**: After "Common Mistakes and Fixes" section

---

### 7. **50-testing-deployment.mdc** (Addition) 🔄
**New section**: Upgrade and Migration Procedures

**What's added:**
- openSUSE Leap version upgrade (15.6 → 15.7)
- Home-Manager/nixpkgs major version updates
- Docker and NVIDIA driver updates
- Migration to new hardware
- Breaking change checklist
- Version compatibility matrix
- Emergency rollback plan
- Example migration timeline

**Where to add**: After "Continuous Verification" section

---

## File Structure Summary

```
.cursor/rules/
├── 00-style-canon.mdc            # Universal standards (existing, updated)
├── 05-project-overview.mdc       # Project context (existing, updated)
├── 10-kiwi-architecture.mdc      # 4-layer + laptop patterns (update with new section)
├── 20-nix-home-manager.mdc       # Nix patterns (existing)
├── 25-lefthook-quality.mdc       # NEW: Quality gates
├── 30-container-runtime.mdc      # Docker + GPU (existing)
├── 40-documentation.mdc          # Docs governance (existing)
├── 50-testing-deployment.mdc     # Testing + upgrades (update with new section)
├── 55-networking-privacy.mdc     # NEW: VPN + DNS
├── 60-package-management.mdc     # Package policies (existing)
├── 65-backup-restore.mdc         # NEW: Backup strategies
├── 70-troubleshooting.mdc        # NEW: Debug procedures
├── 75-ide-config.mdc             # NEW: IDE management
└── RULES_INDEX.md                # Updated index
```

---

## Implementation Checklist

### Phase 1: Add New Rules (Immediate)
- [ ] Copy `25-lefthook-quality.mdc` to `.cursor/rules/`
- [ ] Copy `55-networking-privacy.mdc` to `.cursor/rules/`
- [ ] Copy `65-backup-restore.mdc` to `.cursor/rules/`
- [ ] Copy `70-troubleshooting.mdc` to `.cursor/rules/`
- [ ] Copy `75-ide-config.mdc` to `.cursor/rules/`
- [ ] Update `RULES_INDEX.md` with new entries

### Phase 2: Update Existing Rules
- [ ] Add laptop section to `10-kiwi-architecture.mdc`
- [ ] Add upgrade section to `50-testing-deployment.mdc`

### Phase 3: Create Supporting Scripts

**Lefthook:**
- [ ] Create `lefthook.yml` at repo root
- [ ] Create `tools/validate/check-anti-patterns.sh`
- [ ] Create `tools/validate/check-layer-assignments.sh`

**Networking:**
- [ ] Create `scripts/setup-dns.sh`
- [ ] Create `scripts/setup-protonvpn.sh`

**Backup:**
- [ ] Create `scripts/setup-backup-hdd.sh`
- [ ] Create `scripts/backup-to-hdd.sh`
- [ ] Create `scripts/restore-from-hdd.sh`
- [ ] Create `scripts/setup-rclone.sh`
- [ ] Create `scripts/backup-to-cloud.sh`
- [ ] Create `scripts/restore-from-cloud.sh`

**IDE:**
- [ ] Create `scripts/backup-vscode-extensions.sh`
- [ ] Create `scripts/restore-vscode-extensions.sh`
- [ ] Create `scripts/sync-cursor-from-vscode.sh`
- [ ] Create `scripts/backup-ide-configs.sh`
- [ ] Create `scripts/restore-ide-configs.sh`

**Laptop:**
- [ ] Create `scripts/setup-laptop-power.sh`

### Phase 4: Create Home-Manager Modules
- [ ] Create `home/modules/ide.nix` (VS Code configuration)
- [ ] Create `home/modules/backup.nix` (rclone package)
- [ ] Create `home/modules/networking.nix` (VPN helpers)
- [ ] Import new modules in `home/home.nix`

### Phase 5: Testing
- [ ] Install lefthook and run quality checks
- [ ] Test DNS configuration script
- [ ] Test backup to external HDD (if available)
- [ ] Test IDE config backup/restore
- [ ] Update daily summary with implementation notes

---

## Priority Recommendations

### High Priority (Implement Now)
1. **25-lefthook-quality.mdc** - Catch errors before they reach main
2. **70-troubleshooting.mdc** - Save time debugging
3. **75-ide-config.mdc** - Protect your IDE setups

### Medium Priority (This Week)
4. **65-backup-restore.mdc** - Data protection
5. **55-networking-privacy.mdc** - Privacy foundation

### Lower Priority (When Needed)
6. Laptop patterns (when deploying to laptop)
7. Upgrade procedures (when Leap 15.7 releases)

---

## What These Rules Prevent

### Hallucinations Blocked:
- ✅ Scripts without executable bits
- ✅ Podman syntax in new code
- ✅ TeX scheme-full suggestions
- ✅ Non-existent packages
- ✅ Wrong layer assignments

### Problems Avoided:
- ✅ Lost IDE configurations
- ✅ No backup strategy
- ✅ DNS leaks on public WiFi
- ✅ Unknown troubleshooting procedures
- ✅ Failed upgrades without rollback plan

---

## Testing the Rules

### Test 1: Lefthook
```bash
# Install lefthook
sudo zypper install lefthook

# Create basic lefthook.yml
cat > lefthook.yml <<'EOF'
pre-commit:
  commands:
    shellcheck:
      glob: "**/*.sh"
      run: shellcheck {staged_files}
EOF

# Install hooks
lefthook install

# Test
echo "podman run test" > test.sh
git add test.sh
git commit -m "test"
# Should fail with Podman detection
```

### Test 2: Rules Reference
Ask AI:
- "I want to add GPU support for containers"
  - Should reference `30-container-runtime.mdc`
  - Should use Docker `--gpus all` syntax
  - Should NOT suggest Podman

- "I need to backup my IDE configurations"
  - Should reference `75-ide-config.mdc`
  - Should suggest scripts and procedures

- "System won't boot after update"
  - Should reference `70-troubleshooting.mdc`
  - Should suggest Btrfs snapshot rollback

---

## Notes About Omitted Items

Per your feedback, I **did NOT create** rules for:
- ❌ Secrets management (using openSUSE/Nix defaults)
- ❌ CI/CD (lefthook quality gates instead)
- ❌ Multi-user scenarios (single user only)
- ❌ Contributors guide (personal project)

---

## Next Steps

1. **Review** all new rule files
2. **Copy** to `.cursor/rules/` directory
3. **Update** existing rules with new sections
4. **Create** supporting scripts as needed
5. **Test** with AI prompts to verify rules work
6. **Document** in daily summary

---

## Summary

You now have **13 total rules** covering:
- ✅ Universal standards (00)
- ✅ Project context (05)
- ✅ Architecture (10, with laptop patterns)
- ✅ Nix patterns (20)
- ✅ Quality gates (25)
- ✅ Container runtime (30)
- ✅ Documentation (40)
- ✅ Testing/deployment (50, with upgrades)
- ✅ Networking/VPN (55)
- ✅ Package management (60)
- ✅ Backup/restore (65)
- ✅ Troubleshooting (70)
- ✅ IDE configuration (75)

These rules should prevent most hallucinations and provide practical guidance for maintaining geckoforge across desktop and laptop deployments.

**Ready to implement when you are!**